import {
  CodeSurfer,
  CodeSurferColumns,
  Step
} from "code-surfer";
import { github, vsDark } from "@code-surfer/themes";
import "prismjs/components/prism-docker.js"

import ImageWithLabel from './components/ImageWithLabel'
import YoutubeVideo from './components/YoutubeVideo'

import dockerLogo from './static/docker-logo.png'
import containerVsVm from './static/containers-vs-virtual-machines.jpg'
import dockerWikiBasics from './static/docker-wiki-basics.png'
import dockerLinuxInterfaces from './static/docker-linux-interfaces.png'

export const theme = vsDark;

<!--  1 Container vs VM -->
<!--  2 Why Docker? History, Pro vs Cons, Alternatives -->
<!--  3 Install Docker -->
<!--  4 Build a Docker Container -->
<!--  4 build context. ************************************************************************** -->
<!--  4 Run a Docker Container -->
<!--  5 Link two Docker Container -->
<!--  6 Build a Docker Image (Architectures, base images, builder pattern) -->
<!--  6 What is Docker-compose -->
<!--  6 What is Docker-swarm -->
<!--  6 What is Kubernetes -->
<!--  6 Questions -->
<!--  6 Thank you -->
<!--  6 Link to repo -->

# Docker 101

<ImageWithLabel style={{backgroundColor: "#FFFFFF"}} label="Author: Marcel Rösler">
    <img src={dockerLogo} />
</ImageWithLabel>

https://github.com/BelphegorPrime/mdx-decker

---

<ImageWithLabel label="Container VS Virtual Maschine">
    <img src={containerVsVm} />
</ImageWithLabel>

---

## Additional Resources Container vs VM

[docker-containers-vs-vms](https://www.weave.works/blog/a-practical-guide-to-choosing-between-docker-containers-and-vms)

---

<ImageWithLabel>
    <img src={dockerWikiBasics} />
</ImageWithLabel>

---

<ImageWithLabel
    style={{backgroundColor: "#FFFFFF"}}
    label="Docker kann verschiedene Schnittstellen verwenden, um auf Virtualisierungsfunktionen des Linux-Kernels zuzugreifen."
>
    <img src={dockerLinuxInterfaces} />
</ImageWithLabel>

---

## Additional Resources to Docker

[https://de.wikipedia.org/wiki/Docker_(Software)](https://de.wikipedia.org/wiki/Docker_(Software))

---

## Install Docker

There are multiple ways but a good way is to follow the installation guide in the official documentation

https://docs.docker.com/engine/install/debian/

---

## Begriffe

1. Dockerfile

    eine Textdatei, die mit verschiedenen Befehlen ein Image beschreibt.<br />
    Diese werden bei der Ausführung abgearbeitet und für jeden Befehl<br />
    wird ein einzelner Layer angelegt.

2. Layer

    ein Layer ist Teil eines Images und enthält einen Befehl oder eine<br />
    Datei, die dem Image hinzugefügt wurde. Anhand der Layer kann die<br />
    ganze Historie des Images nachvollzogen werden.

---

## Einschub - Storage Driver

- overlay2
- fuse-overlayfs
- btrfs and zfs
- vfs
- aufs
- devicemapper
- overlay

https://docs.docker.com/storage/storagedriver/select-storage-driver/

---

## Begriffe 2

3. Image

    Speicherabbild eines Containers. Das Image selbst besteht aus<br />
    mehreren Layern, die schreibgeschützt sind und somit nicht verändert<br />
    werden können. Ein Image ist portabel, kann in Repositories gespeichert<br />
    und mit anderen Nutzern geteilt werden. Aus einem Image können immer<br />
    mehrere Container gestartet werden.

4. Repository

    ein Repository ist ein Satz gleichnamiger Images mit verschiedenen<br />
    Tags, zumeist Versionen.

---

## Begriffe 3

5. Registry

    eine Registry, wie zum Beispiel Docker Hub oder Artifactory,<br />
    dient der Verwaltung von Repositories.

6. Container

    als Container wird die aktive Instanz eines Images bezeichnet.<br />
    Der Container wird also gerade ausgeführt und ist beschäftigt.<br />
    Sobald der Container kein Programm ausführt oder mit seinem<br />
    Auftrag fertig ist, wird der Container automatisch beendet.

---

<CodeSurfer>

```json title="Vorwort Beispiel"
[
  {
    "domain": "omv.local.net",
    "portMap": [
      {
        "from": 80,
        "to": 9999
      }
    ]
  },
  {
    "domain": "router.local.net",
    "portMap": [
      {
        "from": 80,
        "ip": "192.168.0.1",
        "to": 80
      }
    ]
  },
  ...
]
```

</CodeSurfer>

---

<CodeSurfer>

```docker title="Dockerfile und die Layer"
FROM node:12

WORKDIR /app

COPY ./balancer.json .
COPY ./balancer.js .

ENV ip=192.168.0.111

RUN node balancer.js

```

```docker 1
FROM node:lts

WORKDIR /app

COPY ./balancer.json .
COPY ./balancer.js .

ENV ip=192.168.0.111

RUN node balancer.js

```

```docker 7,8,9,10,11
FROM node:lts

WORKDIR /app

COPY ./balancer.json .
COPY ./balancer.js .
COPY ./.env .

RUN npm init -y
RUN npm i dotenv

RUN node balancer.js

```

```docker 5,6
FROM node:lts

WORKDIR /app

RUN npm init -y
RUN npm i dotenv

COPY ./balancer.json .
COPY ./balancer.js .
COPY ./.env .

RUN node balancer.js

```

```docker 1
FROM node:lts AS builder

WORKDIR /app

RUN npm init -y
RUN npm i dotenv

COPY ./balancer.json .
COPY ./balancer.js .
COPY ./.env .

RUN node balancer.js

```

```docker 14,15
FROM node:lts AS builder

WORKDIR /app

RUN npm init -y
RUN npm i dotenv

COPY ./balancer.json .
COPY ./balancer.js .
COPY ./.env .

RUN node balancer.js

FROM haproxy:2.3
COPY --from=builder /app/haproxy.cfg /usr/local/etc/haproxy/haproxy.cfg

```

</CodeSurfer>

---

## Build Context

---

<CodeSurfer>

```yml title="A DOCKER-COMPOSE FILE"
version: "3"

services:
  balancer:
    container_name: balancer
    build:
      context: .
      dockerfile: ./Dockerfile
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./cert:/config
    sysctls:
      - net.ipv4.ip_unprivileged_port_start=0
    restart: unless-stopped
```

```diff 1 subtitle="docker-compose version"

```

```diff 3 subtitle="services"

```

```diff 4:16

```

</CodeSurfer>

---

<CodeSurfer>

```js
console.log(1);
console.log(2);
console.log(3);
```

```diff 1 subtitle="log 1"

```

```diff 2 subtitle="log 2"

```

```diff 3 subtitle="log 3"

```

</CodeSurfer>

---

<CodeSurferColumns themes={[vsDark, github]}>

<Step>

```js
const magna = aliqua => aliqua.ut((enim, ad) => enim, 0);
```

```js
const minim = (ad, enim) => dolore.magna(ad / enim);
```

</Step>

<Step>

```js
const lorem = (ipsum, dolor, sit) => {
  const amet = dolor - ipsum;
  return consectetur.adipiscing(
    {
      elit: sed.eiusmod(sit - dolor) / amet + 2,
    },
    (tempor, incididunt) => ipsum + amet * incididunt
  );
};

const magna = aliqua => aliqua.ut((enim, ad) => enim, 0);
```

```js
const minim = (ad, enim) => dolore.magna(ad / enim);

const sed = (eiusmod, tempor, incididunt) => {
  const ut = tempor - eiusmod;
  return labore.et(
    {
      amet: dolore.magna(incididunt - tempor) / ut + 2,
    },
    (aliqua, elit) => eiusmod + ut * elit
  );
};
```

</Step>

</CodeSurferColumns>

---

<YoutubeVideo src="https://www.youtube-nocookie.com/embed/D2gXo-T4wqA" />

---

## Questions

---

Thank you for your participation.

